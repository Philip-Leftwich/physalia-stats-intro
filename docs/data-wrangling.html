<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Chapter 4 Data wrangling | 5023Y</title>

    <meta name="author" content="Philip T. Leftwich" />
  
   <meta name="description" content="This book ..." />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="Chapter 4 Data wrangling | 5023Y" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://ueabio.github.io/data-sci" />
  <meta property="og:image" content="https://ueabio.github.io/data-sci/images/logos/twitter_card.png" />
  <meta property="og:description" content="This book ..." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Data wrangling | 5023Y" />
  
  <meta name="twitter:description" content="This book ..." />
  <meta name="twitter:image" content="https://ueabio.github.io/data-sci/images/logos/twitter_card.png" />
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/header-attrs-2.13/header-attrs.js"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.3.1.9000/transition.js"></script>
    <script src="libs/bs3compat-0.3.1.9000/tabs.js"></script>
    <script src="libs/bs3compat-0.3.1.9000/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/font-awesome-5.13.0/js/script.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6NP3MF25W3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-6NP3MF25W3');
    </script>
    <script language="javascript"> 
        function toggle(id) {
            var ele = document.getElementById("toggleText" + id);
            var text = document.getElementById("displayText" + id);
            var buttonText = text.innerHTML.replace("Show ", "");
            buttonText = buttonText.replace("Hide ", "");
            if(ele.style.display == "block") {
                ele.style.display = "none";
                text.innerHTML = "Show " + buttonText;
            } else {
                ele.style.display = "block";
                text.innerHTML = "Hide " + buttonText;
            }
        } 
    </script>

    <script language="javascript">
        function openCode(evt, codeName, id) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent" + id);
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks" + id);
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(codeName).style.display = "block";
            evt.currentTarget.className += " active";
        }
    </script>

    <script language="javascript">
        function hide(id){
            document.getElementById(id).style.display = "none";
        }
    </script>
    </script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
    <link rel="stylesheet" href="include/psyteachr.css" />
    <link rel="stylesheet" href="include/webex.css" />
    <link rel="stylesheet" href="include/style.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="Data Science for Biologists">5023Y</a>:
        <small class="text-muted">Data Science for Biologists</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="data-wrangling" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> Data wrangling</h1>
<p>It may surprise you to learn that scientists actually spend far more time cleaning and preparing their data than they spend actually analysing it. This means completing tasks such as cleaning up bad values, changing the structure of dataframes, reducing the data down to a subset of observations, and producing data summaries.</p>
<p>Many people seem to operate under the assumption that the only option for data cleaning is the painstaking and time-consuming cutting and pasting of data within a spreadsheet program like Excel. We have witnessed students and colleagues waste days, weeks, and even months manually transforming their data in Excel, cutting, copying, and pasting data. Fixing up your data by hand is not only a terrible use of your time, but it is error-prone and not reproducible. Additionally, in this age where we can easily collect massive datasets online, you will not be able to organise, clean, and prepare these by hand.</p>
<p>In short, you will not thrive as a scientist if you do not learn some key data wrangling skills. Although every dataset presents unique challenges, there are some systematic principles you should follow that will make your analyses easier, less error-prone, more efficient, and more reproducible.</p>
<p>In this chapter you will see how data science skills will allow you to efficiently get answers to nearly any question you might want to ask about your data. By learning how to properly make your computer do the hard and boring work for you, you can focus on the bigger issues.</p>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
<p>You should have a workspace ready to work with the Palmer penguins data. Load this workspace now.</p>
Think about some basic checks before you start your work today.
</div>
</div>
<p>Are there objects already in your Enviroment pane? (There shouldn't be <span class="citation">(<a href="#ref-Global-options" role="doc-biblioref"><strong>Global-options?</strong></a>)</span>)</p>
<div id="activity-1-change-column-names" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Activity 1: Change column names</h2>
<p>We are going to learn how to organise data using the <em>tidy</em> format<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>. This is because we are using the <code>tidyverse</code> packages <span class="citation"><a href="references.html#ref-R-tidyverse" role="doc-biblioref">Wickham</a> (<a href="references.html#ref-R-tidyverse" role="doc-biblioref">2021</a>)</span>. This is an opinionated, but highly effective method for generating reproducible analyses with a wide-range of data manipulation tools. Tidy data is an easy format for computers to read.</p>
<p>Here 'tidy' refers to a specific structure that lets us manipulate and visualise data with ease. In a tidy dataset each <em>variable</em> is in one column and each row contains one <em>observation</em>. Each cell of the table/spreadsheet contains the <em>values</em>. One observation you might make about tidy data is it is quite long - it generates a lot of rows of data.</p>
<p><img src="images/tidy-1.png" title="tidy data overview" alt="tidy data overview" width="80%" style="display: block; margin: auto;" /></p>
<p>So we know our data is in R, and we know the columns and names have been imported. But we still don't know whether all of our values imported, or whether it captured all the rows.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="data-wrangling.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CHECK DATA ----</span></span>
<span id="cb24-2"><a href="data-wrangling.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># check the data</span></span>
<span id="cb24-3"><a href="data-wrangling.html#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(penguins)</span>
<span id="cb24-4"><a href="data-wrangling.html#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co">#__________________________----</span></span></code></pre></div>
<p>When we run <code>colnames()</code> we get the identities of each column in our dataframe</p>
<ul>
<li><p><strong>Study name</strong>: an identifier for the year in which sets of observations were made</p></li>
<li><p><strong>Region</strong>: the area in which the observation was recorded</p></li>
<li><p><strong>Island</strong>: the specific island where the observation was recorded</p></li>
<li><p><strong>Stage</strong>: Denotes reproductive stage of the penguin</p></li>
<li><p><strong>Individual</strong> ID: the unique ID of the individual</p></li>
<li><p><strong>Clutch completion</strong>: if the study nest observed with a full clutch e.g. 2 eggs</p></li>
<li><p><strong>Date egg</strong>: the date at which the study nest observed with 1 egg</p></li>
<li><p><strong>Culmen length</strong>: length of the dorsal ridge of the bird's bill (mm)</p></li>
<li><p><strong>Culmen depth</strong>: depth of the dorsal ridge of the bird's bill (mm)</p></li>
<li><p><strong>Flipper Length</strong>: length of bird's flipper (mm)</p></li>
<li><p><strong>Body Mass</strong>: Bird's mass in (g)</p></li>
<li><p><strong>Sex</strong>: Denotes the sex of the bird</p></li>
<li><p><strong>Delta 15N</strong> : the ratio of stable Nitrogen isotopes 15N:14N from blood sample</p></li>
<li><p><strong>Delta 13C</strong>: the ratio of stable Carbon isotopes 13C:12C from blood sample</p></li>
</ul>
<div id="clean-names" class="section level3" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Clean names</h3>
<p>Often we might want to change the names of our variables. They might be non-intuitive, or too long. Our data has a couple of issues:</p>
<ul>
<li><p>Some of the names contain spaces</p></li>
<li><p>Some of the names contain brackets</p></li>
</ul>
<p>R does not like these so let's correct these quickly.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="data-wrangling.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CLEAN DATA ----</span></span>
<span id="cb25-2"><a href="data-wrangling.html#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="data-wrangling.html#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># clean all variable names to snake_case using the clean_names function from the janitor package</span></span>
<span id="cb25-4"><a href="data-wrangling.html#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># note we are using assign &lt;- to overwrite the old version of penguins with a version that has updated names</span></span>
<span id="cb25-5"><a href="data-wrangling.html#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># this changes the data in our R workspace but NOT the original csv file</span></span>
<span id="cb25-6"><a href="data-wrangling.html#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="data-wrangling.html#cb25-7" aria-hidden="true" tabindex="-1"></a>penguins <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>(penguins) <span class="co"># clean the column names</span></span>
<span id="cb25-8"><a href="data-wrangling.html#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="data-wrangling.html#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(penguins) <span class="co"># quickly check the new variable names</span></span></code></pre></div>
</div>
<div id="rename" class="section level3" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Rename</h3>
<p>The <code>clean_names</code> function quickly converts all variable names into snake case. The N and C blood isotope ratio names are still quite long though, so let's clean those with <code>dplyr::rename()</code> where "new_name" = "old_name".</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="data-wrangling.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># shorten the variable names for N and C isotope blood samples</span></span>
<span id="cb26-2"><a href="data-wrangling.html#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="data-wrangling.html#cb26-3" aria-hidden="true" tabindex="-1"></a>penguins <span class="ot">&lt;-</span> <span class="fu">rename</span>(penguins,</span>
<span id="cb26-4"><a href="data-wrangling.html#cb26-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;delta_15n&quot;</span><span class="ot">=</span><span class="st">&quot;delta_15_n_o_oo&quot;</span>,  <span class="co"># use rename from the dplyr package</span></span>
<span id="cb26-5"><a href="data-wrangling.html#cb26-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;delta_13c&quot;</span><span class="ot">=</span><span class="st">&quot;delta_13_c_o_oo&quot;</span>)</span></code></pre></div>
</div>
<div id="glimpsecheck-data-format" class="section level3" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> <code>glimpse</code>check data format</h3>
<p>When we run <code>glimpse()</code> we get several lines of output. The number of observations "rows", the number of variables "columns". Check this against the csv file you have - they should be the same. In the next lines we see variable names and the type of data.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="data-wrangling.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(penguins)</span></code></pre></div>
<p>We can see a dataset with 345 rows (including the headers) and 17 variables
It also provides information on the <em>type</em> of data in each column</p>
<ul>
<li><p><code>&lt;chr&gt;</code> - means character or text data</p></li>
<li><p><code>&lt;dbl&gt;</code> - means numerical data</p></li>
</ul>
<p>Is <code>body_mass_g</code> in the correct data format?</p>
<p><select class='webex-select'><option value='blank'></option><option value='answer'>yes</option><option value=''>no</option></select></p>
</div>
</div>
<div id="dplyr-verbs" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> dplyr verbs</h2>
<table class="table" style="font-size: 16px; width: auto !important; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-35">Table 4.1: </span>dplyr verbs
</caption>
<thead>
<tr>
<th style="text-align:left;">
verb
</th>
<th style="text-align:left;">
action
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
select()
</td>
<td style="text-align:left;">
take a subset of columns
</td>
</tr>
<tr>
<td style="text-align:left;">
filter()
</td>
<td style="text-align:left;">
take a subset of rows
</td>
</tr>
<tr>
<td style="text-align:left;">
arrange()
</td>
<td style="text-align:left;">
reorder the rows
</td>
</tr>
<tr>
<td style="text-align:left;">
summarize()
</td>
<td style="text-align:left;">
reduce raw data to user defined summaries
</td>
</tr>
<tr>
<td style="text-align:left;">
group_by()
</td>
<td style="text-align:left;">
group the rows by a specified column
</td>
</tr>
<tr>
<td style="text-align:left;">
mutate()
</td>
<td style="text-align:left;">
create a new variable
</td>
</tr>
</tbody>
</table>
<div id="select" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Select</h3>
</div>
<div id="filter" class="section level3" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Filter</h3>
</div>
<div id="arrange" class="section level3" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> Arrange</h3>
</div>
</div>
<div id="pipes" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Pipes</h2>
<blockquote class="twitter-tweet" data-width="550" data-lang="en" data-dnt="true" data-theme="light">
<p lang="en" dir="ltr">
I %&gt;% <br> tumble(out_of = "bed") %&gt;% <br> stumble(to = "the kitchen") %&gt;% <br> pour(who = "myself", unit = "cup", what = "ambition") %&gt;% <br> yawn() %&gt;% <br> stretch() %&gt;% <br> try(come_to_live()) <a href="https://t.co/plnA2dZdJ4">https://t.co/plnA2dZdJ4</a>
</p>
— Hadley Wickham (<span class="citation">(<a href="#ref-hadleywickham" role="doc-biblioref"><strong>hadleywickham?</strong></a>)</span>) <a href="https://twitter.com/hadleywickham/status/1359852563726819332?ref_src=twsrc%5Etfw">February 11, 2021</a>
</blockquote>
<p>Pipes look like this: <code>%&gt;%</code> Pipes allow you to send the output from one function straight into another function. Specifically, they send the result of the function before <code>%&gt;%</code> to be the <strong>first</strong> argument of the function after <code>%&gt;%</code>. As usual, it's easier to show, rather than tell so let's look at an example.</p>
<div id="lubridate" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> <code>Lubridate</code></h3>
<p>We can also see there is a <code>date_egg</code> variable. If you check it (using <code>glimpse</code> or any of the new functions you have learned), you should see that it all looks like its been inputted correctly, but R is treating it as words, rather than assigning it a date value.</p>
<p>Is <code>date_egg</code> in the correct format?
<select class='webex-select'><option value='blank'></option><option value='answer'>yes</option><option value=''>no</option></select></p>
<p>We can fix that with the <code>lubridate</code> package. If we use the function <code>dmy</code> then we tell R this is date data in date/month/year format.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="data-wrangling.html#cb28-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="ot">&lt;-</span> penguins <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="data-wrangling.html#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_egg_proper =</span> lubridate<span class="sc">::</span><span class="fu">dmy</span>(date_egg))</span></code></pre></div>
<p>Here we use the <code>mutate</code> function from <code>dplyr</code> to create a new variable called <code>date_egg_proper</code> based on the output of converting the characters in <code>date_egg</code> to date format. The original variable is left intact, if we had specified the "new" variable was also called <code>date_egg</code> then it would have overwritten the original variable.</p>
</div>
<div id="rename-some-values" class="section level3" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Rename some values</h3>
<p>Sometimes we may want to rename the values in our variables in order to make a shorthand that is easier to follow.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="data-wrangling.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use mutate and case_when for an if-else statement that changes the names of the values in a variable</span></span>
<span id="cb29-2"><a href="data-wrangling.html#cb29-2" aria-hidden="true" tabindex="-1"></a>penguins <span class="ot">&lt;-</span> penguins <span class="sc">%&gt;%</span> </span>
<span id="cb29-3"><a href="data-wrangling.html#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">species =</span> <span class="fu">case_when</span>(species <span class="sc">==</span> <span class="st">&quot;Adelie Penguin (Pygoscelis adeliae)&quot;</span> <span class="sc">~</span> <span class="st">&quot;Adelie&quot;</span>,</span>
<span id="cb29-4"><a href="data-wrangling.html#cb29-4" aria-hidden="true" tabindex="-1"></a>                             species <span class="sc">==</span> <span class="st">&quot;Gentoo penguin (Pygoscelis papua)&quot;</span> <span class="sc">~</span> <span class="st">&quot;Gentoo&quot;</span>,</span>
<span id="cb29-5"><a href="data-wrangling.html#cb29-5" aria-hidden="true" tabindex="-1"></a>                             species <span class="sc">==</span> <span class="st">&quot;Chinstrap penguin (Pygoscelis antarctica)&quot;</span> <span class="sc">~</span> <span class="st">&quot;Chinstrap&quot;</span>))</span></code></pre></div>
</div>
<div id="check-for-duplication" class="section level3" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Check for duplication</h3>
<p>It is very easy when inputting data to make mistakes, copy something in twice for example, or if someone did a lot of copy-pasting to assemble a spreadsheet (yikes!). We can check this pretty quickly</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="data-wrangling.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check for duplicate rows in the data</span></span>
<span id="cb30-2"><a href="data-wrangling.html#cb30-2" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="data-wrangling.html#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">duplicated</span>() <span class="sc">%&gt;%</span> <span class="co"># produces a list of TRUE/FALSE statements for duplicated or not</span></span>
<span id="cb30-4"><a href="data-wrangling.html#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>() <span class="co"># sums all the TRUE statements</span></span></code></pre></div>
<pre><code>[1] 0</code></pre>
<p>Great!</p>
</div>
<div id="check-for-typos-or-implausible-values" class="section level3" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> Check for typos or implausible values</h3>
<p>We can also explore our data for very obvious typos by checking for implausibly small or large values</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="data-wrangling.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use summarise to make calculations</span></span>
<span id="cb32-2"><a href="data-wrangling.html#cb32-2" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="data-wrangling.html#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">min=</span><span class="fu">min</span>(body_mass_g, <span class="at">na.rm=</span><span class="cn">TRUE</span>), </span>
<span id="cb32-4"><a href="data-wrangling.html#cb32-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">max=</span><span class="fu">max</span>(body_mass_g, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code></pre></div>
<p>The minimum weight for our penguins is 2.7kg, and the max is 6.3kg - not outrageous. If the min had come out at 27g we might have been suspicious. We will use <code>summarise</code> again to calculate other metrics in the future.</p>
<div class="information">
<p>
our first data insight, the difference the smallest adult penguin in our dataset is nearly half the size of the largest penguin.
</p>
</div>
<p>We can also look for typos by asking R to produce all of the distinct values in a variable. This is more useful for categorical data, where we expect there to be only a few distinct categories</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="data-wrangling.html#cb33-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="data-wrangling.html#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(sex)</span></code></pre></div>
<p>Here if someone had mistyped e.g. 'FMALE' it would be obvious. We could do the same thing (and probably should have before we changed the names) for species.</p>
</div>
<div id="missing-values-na" class="section level3" number="4.3.5">
<h3><span class="header-section-number">4.3.5</span> Missing values: NA</h3>
<p>There are multiple ways to check for missing values in our data</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="data-wrangling.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get a sum of how many observations are missing in our dataframe</span></span>
<span id="cb34-2"><a href="data-wrangling.html#cb34-2" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">%&gt;%</span> </span>
<span id="cb34-3"><a href="data-wrangling.html#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">is.na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb34-4"><a href="data-wrangling.html#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>()</span></code></pre></div>
<p>But this doesn't tell us where these are, fortunately the function <code>summary</code> does this easily</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="data-wrangling.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># produce a summary of our data</span></span>
<span id="cb35-2"><a href="data-wrangling.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(penguins)</span></code></pre></div>
<p>This provides a quick breakdown of the max and min for all numeric variables, as well as a list of how many missing observations there are for each one. As we can see there appear to be two missing observations for measurements in body mass, bill lengths, flipper lengths and several more for blood measures. We don't know for sure without inspecting our data further, <em>but</em> it is likely that the two birds are missing multiple measurements, and that several more were measured but didn't have their blood drawn.</p>
<p>We will leave the NA's alone for now, but it's useful to know how many we have.</p>
<p>We've now got a clean &amp; tidy dataset!!</p>
</div>
</div>
<div id="summing-up" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Summing up</h2>
</div>
<div id="figures" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Figures</h2>
</div>
<div id="preparing-the-data" class="section level2" number="4.6">
<h2><span class="header-section-number">4.6</span> Preparing the data</h2>
<div id="view-and-refine" class="section level3" number="4.6.1">
<h3><span class="header-section-number">4.6.1</span> View and refine</h3>
<p>So we know our data is in R, and we know the columns and names have been imported. But we still don't know whether all of our values imported, or whether it captured all the rows.</p>
<p>There are lots of different ways to view and check data. One useful method is <code>glimpse</code></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="data-wrangling.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check the structure of the data</span></span>
<span id="cb36-2"><a href="data-wrangling.html#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(penguins)</span></code></pre></div>
<p>When we run <code>glimpse()</code> we get several lines of output. The number of observations "rows", the number of variables "columns". Check this against the csv file you have - they should be the same. In the next lines we see variable names and the type of data.</p>
<p>We should be able to see by now, that all is not well!!! <code>Body Mass (g)</code> is being treated as character (string), as is <code>Date Egg</code>, meaning R thinks these contain letters and words instead of numbers and dates.</p>
<p>Other ways to view the data</p>
<ul>
<li><p>type <code>penguins</code> into the Console</p></li>
<li><p>type <code>view(penguins)</code> this will open a spreadsheet in a new tab</p></li>
<li><p>type <code>head(penguins)</code> will show the first 10 lines of the data, rather than the whole dataset</p></li>
</ul>
<blockquote>
<p>**Note - <code>view()</code> lets you do cool stuff like reorder rows and quickly scroll through the dataset without affecting the underlying data.</p>
</blockquote>
</div>
<div id="data-management" class="section level3" number="4.6.2">
<h3><span class="header-section-number">4.6.2</span> Data management</h3>
<p>We've imported the data, checked it and found some inconsistencies.</p>
<p>This is where we start to use some of the core functions from <code>tidyverse</code>.</p>
<p>If R thinks <code>Body Mass (g)</code> is a character variable, then it probably contains some words as well as numbers. So let's have a look at this and compare it to a variable which has been processed correctly</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="data-wrangling.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the first 10 rows of the Flipper Length and Body Mass variables</span></span>
<span id="cb37-2"><a href="data-wrangling.html#cb37-2" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">%&gt;%</span> </span>
<span id="cb37-3"><a href="data-wrangling.html#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Flipper Length (mm)</span><span class="st">`</span>, </span>
<span id="cb37-4"><a href="data-wrangling.html#cb37-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Body Mass (g)</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-5"><a href="data-wrangling.html#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="co"># 10 rows</span></span></code></pre></div>
<p><img src="images/NA.png" width="80%" style="display: block; margin: auto;" /></p>
<blockquote>
<p>**Note - What is the %&gt;% ??? It's known as a pipe. It sends the results of one line of code to the next. So the data penguins is sent to the <code>select</code> function which picks only those variables we want. The result of this is then sent to the <code>head</code> function which with the argument for number of rows set to 10, prints the top 10 rows.</p>
</blockquote>
<blockquote>
<p>The other way to write this series of functions would be to use brackets and the rules of BODMAS:</p>
</blockquote>
<pre><code>head(select(penguins, `Flipper Length (mm)`, `Body Mass (g)`),10)</code></pre>
<blockquote>
<p>Hopefully you agree that the pipes make the code a lot more human-reader friendly. More on pipes later</p>
</blockquote>
<p>So what's the problem with our data? in the Flipper length variable, missing observations have been correctly marked as <code>NA</code> signifying missing data. R can handle missing data just fine. However, in thew Body mass variable, it looks as though someone has actually typed "na" in observations where the data is missing. Here R has failed to recognise an <code>NA</code> and has read it as a word instead. This is because <code>read_csv()</code> looks for gaps or <code>NA</code> but not the typed letters "na".</p>
<p>No problem this is an easy fix. Head back to your script and make the following edit the line for data importing</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="data-wrangling.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in the penguins data, specify that NA strings can be &quot;na&quot; or &quot;NA&quot;</span></span>
<span id="cb39-2"><a href="data-wrangling.html#cb39-2" aria-hidden="true" tabindex="-1"></a>penguins <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/penguin_data.csv&quot;</span>, <span class="at">na=</span><span class="fu">c</span>(<span class="st">&quot;na&quot;</span>,<span class="st">&quot;NA&quot;</span>))</span></code></pre></div>
<p>Now re-check your data using the same lines of code from before.
All ok now?</p>
</div>
</div>
<div id="clean-and-tidy" class="section level2" number="4.7">
<h2><span class="header-section-number">4.7</span> Clean and tidy</h2>
<p>Back to your penguins script.</p>
<p>We have checked the data imported correctly, now its time to <em>clean and tidy</em> the data.</p>
<div id="tidy" class="section level3" number="4.7.1">
<h3><span class="header-section-number">4.7.1</span> Tidy</h3>
<p>In this example our data is already in <code>tidy</code> format i.e. one observation per row. We will cover what to do if data isn't tidy later.</p>
</div>
<div id="clean" class="section level3" number="4.7.2">
<h3><span class="header-section-number">4.7.2</span> Clean</h3>
<p>Here are a few things we might want to do to our data to make it 'clean'.</p>
<ul>
<li><p>Refine variable names</p></li>
<li><p>Format dates and times</p></li>
<li><p>Rename some values</p></li>
<li><p>Check for any duplicate records</p></li>
<li><p>Check for any implausible data or typos</p></li>
<li><p>Check and deal with missing values</p></li>
</ul>
<blockquote>
<p>**Note - Remember because we are doing everything in a script, the original data remains unchanged. This means we have data integrity, and a clear record of what we did to tidy and clean a dataset in order to produce summaries and data visuals</p>
</blockquote>
</div>
<div id="what-we-learned" class="section level3" number="4.7.3">
<h3><span class="header-section-number">4.7.3</span> What we learned</h3>
<p>There was a lot of preparation here, and we haven't really got close to make any major insights. But you have:</p>
<ul>
<li><p>Organised your project space</p></li>
<li><p>Dealt with file formats</p></li>
<li><p>Put data into a specific location and imported into R</p></li>
<li><p>Checked the data import</p></li>
<li><p>Cleaned and tidied the data</p></li>
</ul>
<p>You have also been introduced to the <code>tidyverse</code> and two of its packages</p>
<ul>
<li><p><code>readr</code> <span class="citation"><a href="references.html#ref-R-readr" role="doc-biblioref">Wickham, Hester, et al.</a> (<a href="references.html#ref-R-readr" role="doc-biblioref">2021</a>)</span></p></li>
<li><p><code>dplyr</code> <span class="citation"><a href="references.html#ref-R-dplyr" role="doc-biblioref">Wickham, François, et al.</a> (<a href="references.html#ref-R-dplyr" role="doc-biblioref">2021</a>)</span></p></li>
</ul>
<p>As well as:</p>
<ul>
<li><p><code>janitor</code> <span class="citation"><a href="references.html#ref-R-janitor" role="doc-biblioref">Firke</a> (<a href="references.html#ref-R-janitor" role="doc-biblioref">2021</a>)</span></p></li>
<li><p><code>lubridate</code> <span class="citation"><a href="references.html#ref-R-lubridate" role="doc-biblioref">Spinu et al.</a> (<a href="references.html#ref-R-lubridate" role="doc-biblioref">2021</a>)</span></p></li>
</ul>
</div>
<div id="quitting-1" class="section level3" number="4.7.4">
<h3><span class="header-section-number">4.7.4</span> Quitting</h3>
<div class="warning">
<p>
Remember to <strong>save</strong> your RScript before you leave. And ideally don't save your .Rdata!
</p>
</div>
<ul>
<li><p>Close your RStudio Cloud Browser</p></li>
<li><p>Go to Blackboard to complete this week's quiz!</p></li>
</ul>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="2">
<li id="fn2"><p>(<a href="http://vita.had.co.nz/papers/tidy-data.pdf" class="uri">http://vita.had.co.nz/papers/tidy-data.pdf</a>)<a href="data-wrangling.html#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;
    
    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");
  
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");
  
  var cl = this.classList
  
  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;
  
  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }
  
  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

window.onload = function() {
  console.log("onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }
  
  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }
  
  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
  }

  update_total_correct();
}

</script>
<script>
$( document ).ready(function() {
  var cite = ' ';
  var license = ' <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>';

  $("footer div.row div:eq(1) p").html(
    license
  );
});
</script>

  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>5023Y</strong>: Data Science for Biologists" was written by Philip T. Leftwich. It was last built on 2022-07-27.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


</body>

</html>
